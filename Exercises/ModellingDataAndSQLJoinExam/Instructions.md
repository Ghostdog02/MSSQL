# Анализ и корекция на `data.sql`

Този документ описва идентифицираните проблеми в оригиналния `data.sql` скрипт и стъпките, предприети за поправянето им, за да се осигури логически свързана и работеща база данни.

---

## ⚠️ Идентифицирани проблеми

Оригиналният скрипт имаше няколко критични проблема, които пречеха на данните да бъдат свързани правилно.

### 1. Липсваща връзка в `OrderItems` (Основен проблем)

Таблицата `OrderItems` служи като "мост" (junction table), за да свърже кои **Продукти** (`Products`) се съдържат в коя **Поръчка** (`Orders`).

Оригиналният `INSERT` скрипт изглеждаше така:

```sql
INSERT INTO OrderItems (ProductId, Quantity, Subtotal)
VALUES (1, 5, 5 * 1500), 
       (2, 6, 800),
       ...
```

**Проблемът:** Липсваше `OrderId`. Без него, тези артикули са "сираци" – те съществуват в базата данни, но ние нямаме представа към коя поръчка принадлежат.

### 2. Грешна последователност на INSERT

Скриптът се опитваше да въведе `OrderItems` (артикулите) преди да са създадени самите `Orders` (поръчките). В SQL това е невъзможно, тъй като не можеш да свържеш артикул към поръчка, която все още не съществува.

### 3. Несъответствия в данните

Имаше логически грешки в самите данни:

- Поръчка 2 (`Orders`) беше създадена с `TotalAmount = 800`.
- Свързаният с нея `OrderItems` (артикул 2) беше въведен с `Quantity = 6` и `Subtotal = 800`. Ако продуктът струва 800 (както е в `Products`), то 6 броя биха стрували 4800, а не 800.
- Бяха въведени допълнителни `OrderItems` (артикули 3 и 4), които не принадлежаха към никоя от двете създадени поръчки (`TotalAmount` 7500 или 800).

---

## ✅ Приложени корекции

За да се реши проблемът, бяха направени следните промени:

### 1. Добавяне на `OrderId` към `OrderItems`

`INSERT` командата за `OrderItems` беше коригирана, за да включва `OrderId`, който свързва всеки артикул с правилната поръчка. (Приемаме, че `Orders` `Id=1` е първата, а `Id=2` е втората).

**Коригиран код:**

```sql
-- Тези артикули вече са свързани с Поръчка 1 (TotalAmount = 7500)
INSERT INTO OrderItems (OrderId, ProductId, Quantity, Subtotal)
VALUES (1, 1, 5, 7500); -- Свързваме с OrderId = 1

-- Този артикул е за Поръчка 2 (TotalAmount = 800)
INSERT INTO OrderItems (OrderId, ProductId, Quantity, Subtotal)
VALUES (2, 2, 1, 800); -- Свързваме с OrderId = 2
```

### 2. Коригиране на последователността

Скриптът беше пренареден в следната логическа последователност:

1. `INSERT INTO Users`
2. `INSERT INTO Categories`
3. `INSERT INTO Products` (Те зависят от `Categories`)
4. `INSERT INTO Orders` (Те зависят от `Users`)
5. `INSERT INTO OrderItems` (Те зависят от `Orders` и `Products`)
6. `INSERT INTO Reviews` (Те зависят от `Users` и `Products`)

### 3. Почистване на данните

- За Поръчка 2, `Quantity` беше променено от 6 на 1, за да отговаря на `Subtotal = 800`.
- Двата излишни `OrderItems` (артикули 3 и 4) бяха премахнати, тъй като не отговаряха на нито една от създадените поръчки.